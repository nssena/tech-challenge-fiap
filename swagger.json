{
    "openapi": "3.0.0",
    "info": {
        "title": "API de Gerenciamento de Pedidos e Clientes",
        "description": "**Com essa API, você tem total controle sobre os pedidos e produtos do seu negócio!**\n\n**Funcionalidades:**\n\n* **Painel de usuário:**\n    * Cadastro de clientes (ou identificação de clientes já cadastrados)\n* **Painel de pedidos:**\n    * Listagem de produtos por categoria\n    * Realização de pedidos, inclusive anônimos\n    * Cadastro de telefone para envio de notificações de pedidos prontos para entrega\n    * Acompanhamento do tempo estimado de entrega e status do pedido\n* **Painel administrativo:**\n    * Listagem completa de clientes cadastrados\n    * Cadastro de novos produtos\n    * Edição de informações de produtos\n    * Exclusão de produtos\n  * Pagamento via QR code do Mercado Pago\n   * Envio de notificação de pedidos prontos para entrega\n\n**Ideal para:**\n\n* Lanchonetes e restaurantes que desejam modernizar seus processos de venda\n* Empresas que buscam aumentar a eficiência e a satisfação dos seus clientes\n* Empreendedores que querem oferecer uma experiência de compra inovadora e segura\n\n**Comece a usar agora mesmo e eleve suas vendas para o próximo nível!**",
        "termsOfService": "",
        "contact": {
            "email": "nataliasenasantos@gmail.com"
        },
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://localhost:3000",
            "description": "API de teste"
        }
    ],
    "paths": {
        "/cadastrar": {
            "post": {
                "summary": "Cadastrar cliente",
                "description": "Essa rota permite cadastrar um novo cliente na base de dados",
                "tags": [
                    "Painel de usuário"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/Cliente"
                            },
                            "examples": {
                                "cliente": {
                                    "value": {
                                        "nome": "Usuário teste",
                                        "email": "teste@email.com",
                                        "cpf": "12345678912"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "400": {
                        "description": "Cliente já cadastrado"
                    },
                    "200": {
                        "description": "Cliente cadastrado com sucesso"
                    }
                }
            }
        },
        "/identificar": {
            "post": {
                "summary": "Identificar cliente",
                "description": "Permite identificar o cliente através do cpf cadastrado no sistema",
                "tags": [
                    "Painel de usuário"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/CPF"
                            },
                            "examples": {
                                "cliente": {
                                    "value": {
                                        "cpf": "12345678912"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Cliente já cadastrado"
                    },
                    "404": {
                        "description": "Cliente não encontrado"
                    }
                }
            }
        },
        "/listarclientes": {
            "get": {
                "summary": "Listar todos os clientes cadastrados",
                "description": "Rota para ver todos os clientes cadastrados no banco de dados",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "cliente_id": {
                                                "type": "integer",
                                                "example": 1
                                            },
                                            "nome": {
                                                "type": "string",
                                                "example": "Usuário teste"
                                            },
                                            "email": {
                                                "type": "string",
                                                "example": "teste@email.com"
                                            },
                                            "cpf": {
                                                "type": "string",
                                                "example": "12345678910"
                                            },
                                            "criado_em": {
                                                "type": "string",
                                                "format": "date-time",
                                                "example": "2024-05-05T17:51:55.178Z"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Erro interno do servidor"
                    }
                }
            }
        },
        "/cadastrarproduto": {
            "post": {
                "summary": "Cadastrar produto",
                "description": "Rota para cadastrar um novo produto na base de dados",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/Produto"
                            },
                            "examples": {
                                "cliente": {
                                    "value": {
                                        "nome_produto": "Sprite",
                                        "preco": 399,
                                        "categoria_id": 3,
                                        "descricao": "Lata de 350ml de refrigerante Sprite.",
                                        "imagem": "https://exemplo.com/imagem/sprite.jpg",
                                        "tempo_preparo": 0
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Produto adicionado com sucesso."
                    },
                    "400": {
                        "description": "Erro de validação"
                    },
                    "401": {
                        "description": "Você precisa estar autenticado para acessar esta rota."
                    },
                    "404": {
                        "description": "A categoria especificada não existe."
                    },
                    "409": {
                        "description": "Este produto já foi cadastrado anteriormente."
                    }
                }
            }
        },
        "/editarproduto/{id}": {
            "patch": {
                "summary": "Editar produto",
                "description": "Rota para editar informação(ões) de um produto cadastrado no banco de dados.",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "description": "ID do produto a ser editado"
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/Produto"
                            },
                            "examples": {
                                "cliente": {
                                    "value": {
                                        "nome_produto": "Sprite",
                                        "preco": 499,
                                        "categoria_id": 3,
                                        "descricao": "Lata de 350ml de refrigerante Sprite.",
                                        "imagem": "https://exemplo.com/imagem/sprite.jpg",
                                        "tempo_preparo": 0
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Produto atualizado com sucesso."
                    },
                    "400": {
                        "description": "Erro de validação de dado."
                    },
                    "401": {
                        "description": "Você precisa estar autenticado para acessar esta rota."
                    },
                    "404": {
                        "description": "Produto/categoria não existe."
                    }
                }
            }
        },
        "/excluirproduto/{id}": {
            "delete": {
                "summary": "Excluir produto",
                "description": "Rota para excluir um produto cadastrado no banco de dados.",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "description": "ID do produto a ser excluído."
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Produto excluído com sucesso."
                    },
                    "400": {
                        "description": "Erro de validação de dado."
                    },
                    "401": {
                        "description": "Você precisa estar autenticado para acessar esta rota."
                    },
                    "404": {
                        "description": "Produto não encontrado."
                    }
                }
            }
        },
        "/categoria/{categoria_id}": {
            "get": {
                "summary": "Listar produtos por categoria",
                "description": "Rota para listar produtos de acordo com a categoria cadastrada.",
                "tags": [
                    "Painel de pedidos"
                ],
                "parameters": [
                    {
                        "name": "categoria_id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        },
                        "description": "ID da categoria buscada."
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "id": {
                                                "type": "integer",
                                                "example": 6
                                            },
                                            "nome_produto": {
                                                "type": "string",
                                                "example": "Sprite"
                                            },
                                            "preco": {
                                                "type": "integer",
                                                "example": 399
                                            },
                                            "categoria_id": {
                                                "type": "integer",
                                                "example": 3
                                            },
                                            "descricao": {
                                                "type": "string",
                                                "example": "Lata de 350ml de refrigerante Sprite."
                                            },
                                            "imagem": {
                                                "type": "string",
                                                "example": "https://exemplo.com/imagem/sprite.jpg"
                                            },
                                            "tempo_preparo": {
                                                "type": "integer",
                                                "example": 15
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "ID da categoria inválido."
                    },
                    "404": {
                        "description": "Nenhum produto encontrado para esta categoria."
                    },
                    "500": {
                        "description": "Erro ao listar produtos por categoria"
                    }
                }
            }
        },
        "/novopedido": {
            "post": {
                "summary": "Fazer um pedido",
                "description": "Rota para realizar um novo pedido.",
                "tags": [
                    "Painel de pedidos"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/NovoPedido"
                            },
                            "examples": {
                                "pedido": {
                                    "value": {
                                        "cliente_id": 2,
                                        "detalhes_pedido": [
                                            {
                                                "produto_id": 2,
                                                "preco": 1599,
                                                "quantidade": 1
                                            },
                                            {
                                                "produto_id": 3,
                                                "preco": 599,
                                                "quantidade": 2
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Pedido realizado com sucesso.",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Pedido feito com sucesso."
                                        },
                                        "qrCode": {
                                            "type": "string",
                                            "example": "00020101021243650016COM.MERCADOLIBRE020130636850d04f8-68ae-4203-83bd-a95418a62a415204000053039865802BR5909Test Test6009SAO PAULO62070503***630434EE"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/checarpagamento": {
            "post": {
                "summary": "Checar pagamento do pedido",
                "description": "Checar se o pedido foi pago e enviar para o preparo",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "resource": {
                                        "type": "string",
                                        "example": "https://api.mercadolibre.com/merchant_orders/123456789"
                                    }
                                },
                                "required": [
                                    "resource"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Notificação de pagamento recebida com sucesso.",
                        "content": {
                            "text/plain": {
                                "schema": {
                                    "type": "string",
                                    "example": "Notificação de pagamento recebida com sucesso."
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Erro ao lidar com a notificação de pagamento.",
                        "content": {
                            "text/plain": {
                                "schema": {
                                    "type": "string",
                                    "example": "Erro ao lidar com a notificação de pagamento."
                                }
                            }
                        }
                    }
                }
            }
        },
        "/listarPedidos": {
            "get": {
                "summary": "Lista todos os pedidos pagos em andamento ou prontos para entrega",
                "description": "Uma lista com os pedidos pagos, sua ordem de finalização, tempo estimado de entrega e status atual.",
                "tags": [
                    "Painel de pedidos"
                ],
                "responses": {
                    "200": {
                        "description": "Lista de pedidos retornada com sucesso.",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "pedido_id": {
                                                "type": "integer",
                                                "example": 1
                                            },
                                            "tempo_estimado_entrega": {
                                                "type": "string",
                                                "example": "15"
                                            },
                                            "status_pedido": {
                                                "type": "string",
                                                "example": "em andamento"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/cadastrartelefone": {
            "post": {
                "summary": "Cadastrar número de telefone para um pedido",
                "description": "Esta rota permite cadastrar um número de telefone para um pedido existente.",
                "tags": [
                    "Painel de pedidos"
                ],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Objeto contendo os dados do pedido",
                        "required": true,
                        "schema": {
                            "type": "object",
                            "properties": {
                                "pedido_id": {
                                    "type": "string",
                                    "description": "ID do pedido",
                                    "example": "123456"
                                },
                                "telefone": {
                                    "type": "string",
                                    "description": "Número de telefone a ser cadastrado",
                                    "example": "71999999999"
                                }
                            }
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Telefone cadastrado com sucesso",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Telefone cadastrado com sucesso, aguarde a notificação através deste número."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erro de validação",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Número de telefone inválido. O número deve seguir o padrão 71999999999."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Pedido não encontrado",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Pedido não encontrado para atualizar o telefone."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Erro interno",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Erro interno ao cadastrar telefone."
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/prontoparaentrega/{pedido_id}": {
            "post": {
                "summary": "Atualizar status do pedido para pronto para entrega",
                "description": "Esta rota permite atualizar o status de um pedido para 'pronto para entrega' e enviar uma notificação por SMS para o cliente.",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "pedido_id",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "description": "ID do pedido a ser atualizado"
                        },
                        "example": "123456"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Status do pedido atualizado com sucesso",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Status do pedido atualizado para pronto para entrega. Notificação por SMS enviada com sucesso."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Erro de validação",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Não há telefone disponível para enviar SMS."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Pedido não encontrado",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Pedido não encontrado."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Erro interno",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Erro interno ao mudar o status do pedido para pronto para entrega."
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/pedidofinalizado/{pedido_id}": {
            "post": {
                "summary": "Atualizar status do pedido para finalizado",
                "description": "Esta rota permite atualizar o status de um pedido para 'finalizado' no banco de dados.",
                "tags": [
                    "Painel administrativo"
                ],
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "parameters": [
                    {
                        "name": "pedido_id",
                        "in": "path",
                        "description": "ID do pedido a ser atualizado",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Status do pedido atualizado com sucesso",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Status do pedido atualizado para finalizado."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Pedido não encontrado",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Pedido não encontrado."
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "500": {
                        "description": "Erro interno",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "mensagem": {
                                            "type": "string",
                                            "example": "Erro interno ao atualizar o status do pedido para finalizado."
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "Cliente": {
                "type": "object",
                "properties": {
                    "nome": {
                        "type": "string",
                        "description": "Nome do cliente (máximo 50 caracteres)",
                        "required": true,
                        "messages": {
                            "string.base": "O nome do cliente deve ser uma string",
                            "string.max": "O nome do cliente deve ter no máximo {#limit} caracteres",
                            "any.required": "O nome do cliente é obrigatório"
                        }
                    },
                    "email": {
                        "type": "string",
                        "format": "email",
                        "description": "Email do cliente (máximo 100 caracteres)",
                        "required": true,
                        "messages": {
                            "string.email": "O email fornecido é inválido",
                            "string.max": "O email do cliente deve ter no máximo {#limit} caracteres",
                            "any.required": "O email do cliente é obrigatório"
                        }
                    },
                    "cpf": {
                        "type": "string",
                        "pattern": "^[0-9]+$",
                        "description": "CPF do cliente (11 dígitos)",
                        "required": true,
                        "messages": {
                            "string.length": "O CPF do cliente deve ter 11 dígitos",
                            "string.pattern.base": "O CPF do cliente deve conter apenas números",
                            "any.required": "O CPF do cliente é obrigatório"
                        }
                    }
                }
            },
            "CPF": {
                "type": "object",
                "properties": {
                    "cpf": {
                        "type": "string",
                        "pattern": "^[0-9]+$",
                        "description": "CPF do cliente (11 dígitos)",
                        "required": true,
                        "messages": {
                            "string.length": "O CPF do cliente deve ter 11 dígitos",
                            "string.pattern.base": "O CPF do cliente deve conter apenas números",
                            "any.required": "O CPF do cliente é obrigatório"
                        }
                    }
                }
            },
            "Produto": {
                "type": "object",
                "properties": {
                    "nome_produto": {
                        "type": "string",
                        "description": "Nome do produto (máximo 100 caracteres)",
                        "maxLength": 100,
                        "messages": {
                            "any.required": "O nome do produto é obrigatório.",
                            "string.empty": "O nome do produto não pode estar vazio.",
                            "string.trim": "O nome do produto não pode conter apenas espaços em branco.",
                            "string.max": "O nome do produto deve ter no máximo {#limit} caracteres."
                        }
                    },
                    "preco": {
                        "type": "integer",
                        "description": "Preço do produto",
                        "minimum": 1,
                        "messages": {
                            "any.required": "O preço é obrigatório.",
                            "number.base": "O preço deve ser um número inteiro.",
                            "number.integer": "O preço deve ser um número inteiro.",
                            "number.positive": "O preço deve ser um número positivo."
                        }
                    },
                    "categoria_id": {
                        "type": "integer",
                        "description": "ID da categoria do produto",
                        "minimum": 1,
                        "messages": {
                            "any.required": "A categoria é obrigatória.",
                            "number.base": "A categoria deve ser um número inteiro.",
                            "number.positive": "A categoria deve ser um número positivo."
                        }
                    },
                    "descricao": {
                        "type": "string",
                        "description": "Descrição do produto (máximo 255 caracteres)",
                        "maxLength": 255,
                        "messages": {
                            "string.max": "A descrição deve ter no máximo {#limit} caracteres."
                        }
                    },
                    "imagem": {
                        "type": "string",
                        "description": "URL da imagem do produto (máximo 255 caracteres)",
                        "maxLength": 255,
                        "format": "uri",
                        "messages": {
                            "string.uri": "A URL da imagem não é válida.",
                            "string.max": "A URL da imagem deve ter no máximo {#limit} caracteres."
                        }
                    },
                    "tempo_preparo": {
                        "type": "integer",
                        "description": "Tempo de preparo do produto em minutos",
                        "minimum": 0,
                        "messages": {
                            "any.required": "O tempo de preparo é obrigatório.",
                            "number.base": "O tempo de preparo deve ser um número inteiro.",
                            "number.integer": "O tempo de preparo deve ser um número inteiro.",
                            "number.min": "O tempo de preparo deve ser igual ou maior que zero."
                        }
                    }
                },
                "required": [
                    "nome_produto",
                    "preco",
                    "categoria_id",
                    "tempo_preparo"
                ]
            },
            "NovoPedido": {
                "type": "object",
                "properties": {
                    "cliente_id": {
                        "type": "integer",
                        "description": "ID do cliente que está fazendo o pedido",
                        "example": 2
                    },
                    "detalhes_pedido": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "produto_id": {
                                    "type": "integer",
                                    "description": "ID do produto a ser adicionado ao pedido",
                                    "example": 2
                                },
                                "preco": {
                                    "type": "integer",
                                    "description": "Preço unitário do produto em centavos",
                                    "example": 1599
                                },
                                "quantidade": {
                                    "type": "integer",
                                    "description": "Quantidade do produto a ser adicionada ao pedido",
                                    "example": 1
                                }
                            },
                            "required": [
                                "produto_id",
                                "preco",
                                "quantidade"
                            ]
                        }
                    }
                },
                "required": [
                    "cliente_id",
                    "detalhes_pedido"
                ]
            }
        },
        "securitySchemes": {
            "ApiKeyAuth": {
                "type": "apiKey",
                "in": "header",
                "name": "authorization"
            }
        }
    }
}